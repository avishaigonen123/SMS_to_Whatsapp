import config
from whatsapp_api_client_python import API
import requests
import json 


apiUrl = config.API_URL
idInstance = config.ID_INSTANCE
apiTokenInstance = config.API_TOKEN_INSTANCE

# Initialize GreenAPI client
greenAPI = API.GreenAPI(idInstance, apiTokenInstance)

# set minutes for last message
minutes = 20

# Construct the URL for retrieving last incoming messages
url = f"{apiUrl}/waInstance{idInstance}/lastIncomingMessages/{apiTokenInstance}?minutes={minutes*60}"

# Send GET request to the API endpoint
response = requests.get(url)

# Check if the request was successful
messages = response.json()

print(messages[1])

for message in messages:
    print(message)

# Define the substring to search for
search_text = "hello world"

# Filter messages containing the search text
filtered_messages = [msg for msg in messages if 'textMessage' in msg and search_text in msg['textMessage']]

def send_message(message, chat_id):
    pass
